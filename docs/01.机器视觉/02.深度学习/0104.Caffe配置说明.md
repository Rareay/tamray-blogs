---
title: Caffe配置说明
date: 2020-9-15 16:03:13
permalink: /pages/cedeee/
categories: 
  - 机器视觉
  - 深度学习
tags: 
  - 
---


## 1 slover_xx.prototxt 训练参数文件

[参考](https://www.cnblogs.com/MY0213/p/9560642.html)

首先贴一个实例，然后一个个说明：

```shell
net: "examples/mnist/lenet_train_test.prototxt"
test_iter: 100
test_interval: 500
base_lr: 0.01
momentum: 0.9
type: SGD
weight_decay: 0.0005
lr_policy: "inv"
gamma: 0.0001
power: 0.75
display: 100
max_iter: 20000
snapshot: 5000
snapshot_prefix: "examples/mnist/lenet"
solver_mode: CPU
```

### 1.1 指定网络模型
```shell
net: "examples/mnist/lenet_train_test.prototxt"
```
设置要训练的深度网络模型，训练、测试模型可以单独设置：
```shell
train_net: "examples/hdf5_classification/logreg_auto_train.prototxt"
test_net: "examples/hdf5_classification/logreg_auto_test.prototxt"
```

### 1.2 迭代次数
```shell
test_iter: 100
```
指完成一次测试需要向模型传输 100 批次数据。`test_interval` x `test_batch_size` 应该为测试数据集总数。
  
```shell
test_interval: 500
```
测试间隔。也就是每训练 500 次，才进行一次测试，`test_interval` x `train_batch_size` 应该为训练数据集总数或其倍数。

```shell
test_initialization: false
```
刚启动就进行测试。false的话不进行第一次的测试。

### 1.3 学习率衰减

```shell
stepsize: 300
base_lr: 0.01
lr_policy: "inv"
gamma: 0.0001
power: 0.75
```
每迭代 stepsize 次降低学习速率，base_lr 为基础学习率，lr_policy 为衰减方式，可以设置为以下几种（iter为当前迭代次数）：


- `fixed`，固定学习速率：$basei\_lr$
- `step`，步进衰减：$base\_lr * gamma ^ {floor\frac{iter}{stepsize}}$
- `exp`，指数衰减：$base\_lr * gamma ^ {iter}$
- `inv`，倒数衰减：$base\_lr (1 + gamma * iter) ^ {- power}$
- `multistep`，多步衰减，与步进衰减类似，允许非均匀步进值(stepvalue)
- `poly`，多项式衰减：$base\_lr (1 - \frac{iter}{max\_iter} )^ {power}$
- `sigmoid`，S形衰减：$base\_lr ( \frac{1}{1 + e^{-gamma * (iter - stepsize)}})$

### 1.4 优化方法
```shell
type: SGD
```

优化算法，有几种可选："SGD","AdaDelta","AdaGrad","Adam","Nesterov","RMSProp"。[参考这里](https://www.cnblogs.com/guoyaohua/p/8542554.html)

### 1.5 权重衰减
```shell
weight_decay: 0.0005
```
权重衰减项，防止过拟合的一个参数。

### 1.6 显示
```shell
display: 100
```
每训练100次，在屏幕上显示一次。如果设置为0，则不显示。

### 1.7 最大迭代次数
```shell
max_iter: 20000
```
最大迭代次数。这个数设置太小，会导致没有收敛，精确度很低。设置太大，会导致震荡，浪费时间。

### 1.8 保存快照
```shell
snapshot: 500
```
指每迭代 500 次存一个快照，默认不保存。

```shell
snapshot_prefix: "examples/mnist/lenet"
````
保存地址，默认为模型所在的目录下。

```shell
snapshot_diff: true
```
是否保存梯度值，默认为false,不保存。

```shelll
snapshot_format: HDF5
```
保存的类型。有两种选择：HDF5 和BINARYPROTO ，默认为BINARYPROTO

### 1.9 训练方式
```shell
solver_mode: CPU
```
设置运行模式。默认为GPU,如果你没有GPU,则需要改成CPU,否则会出错。


## 2 train_xx.prototxt 模型参数

[参考](https://www.cnblogs.com/sddai/p/10200419.html)

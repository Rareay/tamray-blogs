---
title: SLAM知识点
date: 2020-08-28 15:49:54
permalink: /pages/9fc2c3/
categories: 
  - 机器视觉
  - Slam
tags: 
  - 
---
# SLAM知识点


## 1 SLAM实验环境

|操作系统：|Ubuntu16 / Ubuntu18|
|--|--|
|编译工具：|cmake|
|依赖库：|Eigen、Sophus、|

## 2 三维空间刚体运动

<img src='/pic/021.png' width='500'/>

### 2.1 旋转矩阵（R: 3x3）
假设坐标系从 $e$ 经过了欧式变换后，其正交基向量从 $\begin{bmatrix}e_1, e_2, e_3\end{bmatrix}$ 变成了 $\begin{bmatrix}e_1' , e_2' , e_3' \end{bmatrix}$，在变换中存在一个向量 $a$，其坐标从 $\begin{bmatrix}a_1\\a_2\\a_3\end{bmatrix}$ 变成了  $\begin{bmatrix}a_1' \\a_2' \\a_3' \end{bmatrix}$，所以满足关系：
$$\begin{bmatrix}e_1, e_2, e_3\end{bmatrix}\begin{bmatrix}a_1\\a_2\\a_3\end{bmatrix} = \begin{bmatrix}e_1' , e_2' , e_3' \end{bmatrix}\begin{bmatrix}a_1' \\a_2' \\a_3' \end{bmatrix} $$
可以转换成：
$$a = \begin{bmatrix}a_1\\a_2\\a_3\end{bmatrix} = \begin{bmatrix}e_1^Te_1'  & e_1^Te_2' &e_1^Te_3' \\e_2^Te_1' &e_2^Te_2' &e_2^Te_3' \\e_3^Te_1' &e_3^Te_3' &e_1^Te_3' \end{bmatrix} \begin{bmatrix}a_1' \\a_2' \\a_3' \end{bmatrix} = Ra'  $$
这里的 $R$ 称为`旋转矩阵`，它是一个行列式为1的正交矩阵（即逆为自身转置的矩阵），则反向旋转有：
$$a' = R^{-1}a = R^Ta$$
如果要描述向量在空间中的欧式变换，还需要一个平移向量 $t$，因为 $R$ 只描述了旋转，所以向量 $a_1$ 到向量 $a_2$ 的欧式变换：
$$a_2 = Ra_1 + t$$

### 2.2 变换矩阵（T: 4x4）
上式的欧式变换用到了 $R$ 和 $t$，有两次变换就不是线性关系，但可以使用齐次坐标和变换矩阵来将它线性化，设`变换矩阵` $T$：
$$T = \begin{bmatrix}R&t\\0^T&1 \end{bmatrix}$$
对应的欧式变化如下：
$$\begin{bmatrix}a^2 \\1\end{bmatrix} = \begin{bmatrix}R&t\\0^T&0\end{bmatrix} \begin{bmatrix}a^1\\1\end{bmatrix} = T\begin{bmatrix}a^1\\1\end{bmatrix}$$


### 2.3 旋转向量和欧拉角
- 旋转向量
	旋转状态也可以用一个`旋转轴`$n$和`旋转角`$\theta$来描述，组合在一起为旋转向量 ($\scriptsize \theta n$)，它和旋转矩阵可以相互转化：
	旋转向量 -> 旋转矩阵：
	$$R = cos{\theta I} + (1-cos{\theta })nn^T+sin{\theta} \hat{n} $$
	旋转矩阵 -> 旋转向量：

	$$\begin{aligned} tr(R) &= cos{\theta}I + (1-cos{\theta})tr(nn^T) + sin\theta tr(\hat{n}) \\ &= 3cos{\theta} + (1 - cos{\theta}) \\ &= 1 + 2cos{\theta} \end{aligned}$$


	$$\theta = arccos{\frac{tr(R)-1}{2}}$$
	$$Rn=n$$
上面的 $\hat{n}$ 表示 $n$ 的反对称矩阵:
$$\hat{a} = \begin{bmatrix} 0 & -a_3 & a_2 \\ a_3 & 0 & -a_1 \\ -a_2 & a_1 & 0 \end{bmatrix}$$

- 欧拉角
	使用 $\begin{bmatrix}r , p , y\end{bmatrix}^T$ 来描述旋转，表示分别绕三个坐标轴旋转，不同的旋转顺序会导致结果不一样，如 $rpy$ 角的旋转顺序是 $ZYX$，欧拉角的缺点是存在`万象锁问题`；

### 2.4 四元数


$$q = \begin{bmatrix} s, v \end{bmatrix}^T, s = q_0\in R, v = \begin{bmatrix}q_1, q_2, q_3\end{bmatrix}^T\in R^3$$

四元数为复数，上式中，$s$ 为实部，$v$ 为虚部；

注：c++中的矩阵运算、旋转向量、欧拉角、四元数的转化可以使用Eigen库，参考[这里](http://www.tamray.cn/index.php/2020/08/08/eigen/)；

## 3 李群与李代数
### 3.1 李群
旋转矩阵构成`特殊正交群 SO(3)`，变换矩阵构成了`特殊欧式群 SE(3)`:
$$SO(3) = \{R\in R^{3x3} \mid RR^T = I, det(R) = 1\}$$
$$SE(3) = \{T=\begin{bmatrix}R & t \\ 0^T & 1 \end{bmatrix}\in  R^{4x4} \mid R \in SO(3), t \in R^3\}$$
这类矩阵之所以称之为‘群’，是因为它们具有一些属性，比如它们相乘后还是属于一类：
$$R_1R_2 \in SO(3), T_1T_2 \in SE(3)$$
### 3.1 李代数
推导李代数可以由 $R(t)R(t)^T=I$ 式子引出，求导后在使用反对称矩阵、泰勒展开、微分方程的方法可以得到式子：
$$R(t)=exp(\hat{\phi_0}t)$$ 
即  $R =exp(\hat{\phi})$ ，这里的 $\phi$ 就是李代数；
李代数（$\mathcal{SO(3)}$）:
$$\mathcal{SO(3)} = \{\phi \in R^3, \Phi = \hat{\phi} \in  R^{3x3} \}$$
李代数（$\mathcal{SE(3)}$）:
$$\mathcal{SE(3)} = \{ \xi = \begin{bmatrix}\rho \\ \phi \end{bmatrix}\in R^6, \rho \in R^3, \phi \in \mathcal{SO(3), \hat{\xi} = \begin{bmatrix} \hat{\phi} & \rho \\ 0^T & 0 \end{bmatrix} \in R^{4x4}} \}$$

注：c++中的李群、李代数之间的转化可以使用Sophus库，参考[这里](http://www.tamray.cn/index.php/2020/08/09/sophus/)；

## 4 相机与图像
$$ ZP_{uv} = Z \begin{bmatrix} u \\\ v \\\ 1 \end{bmatrix} = K(RP_w + t) = KTP_w$$
其中，$K$ 为相机内参，$R$、$t$ 为位姿，$P_{uv}$ 为像素坐标，$(RP_w + t) / Z$是归一化坐标；
## 5 非线性优化

